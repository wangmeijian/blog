(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{411:function(t,a,s){"use strict";s.r(a);var e=s(46),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"透过inode来理解硬链接和软链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#透过inode来理解硬链接和软链接"}},[t._v("#")]),t._v(" 透过inode来理解硬链接和软链接")]),t._v(" "),s("h2",{attrs:{id:"什么是inode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是inode"}},[t._v("#")]),t._v(" 什么是inode？")]),t._v(" "),s("p",[t._v("每个文件都对应一个唯一的inode，inode用来存储文件的元信息，包括：")]),t._v(" "),s("ul",[s("li",[t._v("对应的文件")]),t._v(" "),s("li",[t._v("文件字节数")]),t._v(" "),s("li",[t._v("文件数据块的位置")]),t._v(" "),s("li",[t._v("文件的inode号码")]),t._v(" "),s("li",[t._v("文件的硬链接数")]),t._v(" "),s("li",[t._v("文件的读写权限")]),t._v(" "),s("li",[t._v("文件的时间戳")])]),t._v(" "),s("p",[t._v("在Linux系统下，创建一个文件"),s("code",[t._v("hello.txt")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello world'")]),t._v(" -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello.txt'")]),t._v("\n")])])]),s("p",[t._v("接着使用stat命令查看"),s("code",[t._v("hello.txt")]),t._v("的inode信息：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stat")]),t._v(" hello.txt\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("文件：hello.txt\n大小：14        \t块：8          IO 块：4096   普通文件\n设备：fd00h/64768d\tInode：34025713    硬链接：1\n权限："),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0644/-rw-r--r--"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  Uid："),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/    root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   Gid："),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/    root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n环境：unconfined_u:object_r:admin_home_t:s0\n最近访问：2022-08-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:56.158501724 +0800\n最近更改：2022-08-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:56.158501724 +0800\n最近改动：2022-08-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:56.158501724 +0800\n创建时间：2022-08-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:56.158501724 +0800\n")])])]),s("h2",{attrs:{id:"inode和文件名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#inode和文件名"}},[t._v("#")]),t._v(" inode和文件名")]),t._v(" "),s("p",[t._v("操作系统使用inode号码来识别文件，而人使用文件名来识别文件")]),t._v(" "),s("p",[t._v("人在打开文件的时候，文件系统实际上是先通过文件名找到对应的inode号码，然后根据inode号码找到文件inode信息，根据inode信息找到文件内容所在的数据块，最后读取数据。")]),t._v(" "),s("h2",{attrs:{id:"硬链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#硬链接"}},[t._v("#")]),t._v(" 硬链接")]),t._v(" "),s("p",[t._v("文件和inode的关系是一对一，而文件名和inode的关系则是一对多，系统允许多个文件名对应一个inode")]),t._v(" "),s("img",{attrs:{src:"https://user-images.githubusercontent.com/9384140/188419453-8d55b450-ffb8-4441-a359-d38124de6566.png",width:"500"}}),t._v(" "),s("p",[t._v("inode信息中的硬链接（Links）数，就表示当前有几个文件名对应着该inode，换句话说，每个文件名就是文件的一个硬链接")]),t._v(" "),s("h3",{attrs:{id:"增加硬链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#增加硬链接"}},[t._v("#")]),t._v(" 增加硬链接")]),t._v(" "),s("p",[t._v("使用ln命令为"),s("code",[t._v("hello.txt")]),t._v("生成一个硬链接，格式："),s("code",[t._v("ln 源文件名 硬链接文件名")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" hello.txt hello-hard-link.txt\n")])])]),s("p",[t._v("再用"),s("code",[t._v("stat hello.txt")]),t._v("查看源文件的硬链接数，值从1变为2")]),t._v(" "),s("h3",{attrs:{id:"删除硬链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除硬链接"}},[t._v("#")]),t._v(" 删除硬链接")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("rm -f hello-hard-link.txt\n")])])]),s("p",[t._v("再次查看硬链接数，值从2变为1")]),t._v(" "),s("p",[t._v("当一个文件的硬链接大于1时，删除一个硬链接（也就是文件名），不会影响源文件，只有当硬链接数等于0，系统才会删除源文件")]),t._v(" "),s("h3",{attrs:{id:"修改源文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改源文件"}},[t._v("#")]),t._v(" 修改源文件")]),t._v(" "),s("p",[t._v("修改源文件内容，会影响所有硬链接，因为硬链接都是指向同一个源文件的数据块")]),t._v(" "),s("h2",{attrs:{id:"软链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#软链接"}},[t._v("#")]),t._v(" 软链接")]),t._v(" "),s("p",[t._v("软链接也叫符号链接，很好理解，可以理解为window系统里的快捷方式")]),t._v(" "),s("p",[t._v("先创建一个硬链接:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" hello.txt hello_hard_link.txt\n")])])]),s("p",[t._v("然后，创建一个软链接：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s hello.txt hello_s.txt\n")])])]),s("p",[t._v("此时，文件"),s("code",[t._v("hello.txt")]),t._v("有2个硬链接和1个软链接，接下来，删除刚刚用来创建软链接的文件名hello.txt：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -f hello.txt\n")])])]),s("p",[t._v("这个时候，打开文件"),s("code",[t._v("hello_s.txt")]),t._v("就会报错“No such file or directory”。")]),t._v(" "),s("p",[t._v("刚才只是删除了一个文件名，并没有影响到源文件，但是通过软链接打开文件却报错了，并不是因为源文件不存在了，而是因为软链接指向的硬链接被删除了。")]),t._v(" "),s("p",[t._v("这就是软链接和硬链接的区别，软链接指向的是文件名（也就是硬链接），硬链接指向的是文件的inode号码。")]),t._v(" "),s("img",{attrs:{src:"https://user-images.githubusercontent.com/9384140/185368644-02d074bf-fb15-4820-81a0-c1b5762d633f.png",width:"600"}})])}),[],!1,null,null,null);a.default=n.exports}}]);